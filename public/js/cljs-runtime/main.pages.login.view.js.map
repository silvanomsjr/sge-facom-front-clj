{"version":3,"sources":["main/pages/login/view.cljs"],"mappings":"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","names":["js/main","js/main.pages","js/main.pages.login","js/main.pages.login.view","js/main.pages.login.view.usuario","main.pages.login.view/usuario","reagent.core.atom","js/main.pages.login.view.senha","main.pages.login.view/senha","js/main.pages.login.view.login_errors","main.pages.login.view/login_errors","js/main.pages.login.view.erro-modal-aberto?","main.pages.login.view/erro-modal-aberto?","js/main.pages.login.view.login_error_req","main.pages.login.view/login_error_req","js/main.pages.login.view.loading?","main.pages.login.view/loading?","main.pages.login.view/tem-erro?","campo","p1__13207#","cljs.core/deref","cljs.core/some","cljs.core._EQ_","main.pages.login.view/req-to-api","on_success","on_error","ajax.core.POST","main.utils.main/API_URL","js/JSON","cljs.core/clj->js","main.pages.login.view/efetua-login","errors","G__13208","clojure.string/blank?","cljs.core.conj","cljs.core/seq","cljs.core/reset!","p__13209","map__13210","cljs.core/--destructure-map","cljs.core.get","token","js/localStorage","reitit.frontend.easy.replace_state","error","cljs.core.println","main.pages.login.view/logo","main.pages.login.view/loading-spinner","main.pages.login.view/erro-modal","p1__13211#","p1__13212#","main.pages.login.view/login","reitit.frontend.easy.href"],"sourcesContent":["(ns main.pages.login.view\n  (:require\n   [clojure.string :as str]\n   [reitit.frontend.easy :as rfe]\n   [reagent.core :as r]\n   [main.utils.main :refer [API_URL]]\n   [ajax.core :refer [POST]]))\n\n(defonce usuario (r/atom \"\"))\n\n(defonce senha (r/atom \"\"))\n\n(defonce login_errors (r/atom []))\n\n(defonce erro-modal-aberto? (r/atom false))\n\n(defonce login_error_req (r/atom nil))\n\n(defonce loading? (r/atom false))\n\n(defn tem-erro? [campo]\n  (some #(= (:error %) campo) @login_errors))\n\n(defn req-to-api [on_success on_error]\n  (POST (str API_URL \"/users/login\")\n    {:body (.stringify js/JSON (clj->js {:email @usuario :password @senha}))\n     :headers {\"Content-Type\" \"application/json\"}\n     :handler on_success\n     :error-handler on_error\n     :response-format :json\n     :keywords? true}))\n\n(defn efetua-login []\n  (let [errors (cond-> []\n                 (str/blank? @usuario) (conj {:error :usuario})\n                 (str/blank? @senha) (conj {:error :senha}))]\n    (if (seq errors)\n      (reset! login_errors errors)\n      (do\n        (reset! loading? true)\n        (reset! login_errors [])\n        (req-to-api\n         (fn [{:keys [token]}]\n           (if token\n             (do\n               (.setItem js/localStorage \"token\" token)\n               (rfe/replace-state :home))\n             (reset! login_errors [{:error :login-failed}]))\n           (reset! loading? false))\n         (fn [error]\n           (println \"Erro no login: \" error)\n           (reset! login_error_req error)\n           (reset! erro-modal-aberto? true)\n           (reset! login_errors [{:error :login-failed}])\n           (reset! loading? false)))))))\n\n(defn logo []\n  [:div\n   {:class \"flex justify-center items-center gap-2\"}\n   [:img\n    {:src \"/images/ufu_logo_small.png\"\n     :style {:width \"35px\"}}]\n   [:span\n    {:class \"font-bold text-2xl text-[#1c2256]\"}\n    \"SGE FACOM\"]])\n\n(defn loading-spinner []\n  [:div {:class \"fixed inset-0 flex items-center justify-center bg-white/70 z-[999999]\"}\n   [:div {:class \"animate-spin rounded-full h-16 w-16 border-b-2 border-gray-900\"}]])\n\n(defn erro-modal []\n  [:div\n   (when @erro-modal-aberto?\n     [:div {:class \"fixed top-0 right-0 left-0 z-10000000000000 flex justify-center items-center w-full h-[calc(100%-1rem)] max-h-full overflow-y-auto overflow-x-hidden bg-black/30\"}\n      [:div {:class \"relative p-4 w-full max-w-2xl max-h-full\"}\n       [:div {:class \"relative bg-white rounded-lg shadow-sm dark:bg-gray-700\"}\n        [:div {:class \"flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-200 dark:border-gray-600\"}\n         [:h3 {:class \"text-xl font-semibold text-gray-900 dark:text-white\"}\n          \"Ocorreu um erro!\"]\n         [:button {:on-click #(reset! erro-modal-aberto? false)\n                   :class \"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white\"}\n          [:svg {:class \"w-3 h-3\" :fill \"none\" :viewBox \"0 0 14 14\" :xmlns \"http://www.w3.org/2000/svg\" :aria-hidden \"true\"}\n           [:path {:stroke \"currentColor\" :stroke-width \"2\" :stroke-linecap \"round\" :stroke-linejoin \"round\" :d \"M1 1l6 6m0 0l6 6M7 7l6-6M7 7l-6 6\"}]]\n          [:span.sr-only \"Fechar Modal\"]]]\n\n        ;; Modal body\n        [:div {:class \"w-full flex items-center justify-center p-4 md:p-5 space-y-4\"}\n         [:p {:class \"text-base leading-relaxed text-gray-500 dark:text-gray-400\"}\n          (-> @login_error_req\n              :response\n              :error)]]\n        ;; Modal footer\n        [:div {:class \"flex items-center p-4 md:p-5 border-t border-gray-200 rounded-b dark:border-gray-600\"}\n         [:button {:on-click #(reset! erro-modal-aberto? false)\n                   :class \"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800\"}\n          \"Fechar\"]]]]])])\n\n(defn login []\n  [:<>\n   [erro-modal]\n   (when @loading?\n     [loading-spinner])\n   [:div\n    {:class \"w-full h-screen flex justify-center items-center\"}\n    [:div\n     {:class \"w-[40%] p-8 flex flex-col shadow-2xl rounded-sm border-gray-200 border-1 gap-2\"}\n     [:div\n      {:class \"w-full\"}\n      [logo]]\n     [:input\n      {:placeholder \"Usu\u00e1rio\"\n       :class \"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\n       :type \"text\"\n       :on-change #(reset! usuario (-> % .-target .-value))\n       :value @usuario\n       :required true}]\n     [:p {:class (str \"text-red-600 text-sm \" (if (tem-erro? :usuario) \"visible\" \"invisible\"))} \"Usu\u00e1rio \u00e9 obrigat\u00f3rio\"]\n     [:input\n      {:placeholder \"Senha\"\n       :class \"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\n       :type \"password\"\n       :value @senha\n       :on-change #(reset! senha (-> % .-target .-value))\n       :required true}]\n     [:p {:class (str \"text-red-600 text-sm \" (if (tem-erro? :senha) \"visible\" \"invisible\"))} \"Senha \u00e9 obrigat\u00f3ria\"]\n     [:button\n      {:on-click efetua-login\n       :class \"w-full px-3 py-2 bg-[#1c2256] text-white cursor-pointer rounded hover:brightness-140 transition-all duration-200\"}\n      \"Entrar\"]\n     [:div\n      {:class \"w-full flex items-center justify-center\"}\n      [:a {:href (rfe/href :cadastro)} \"Fazer cadastro\"]]]]])\n"]}